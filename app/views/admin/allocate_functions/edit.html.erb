<%= form_for @role, url: admin_role_allocate_functions_path, method: :patch do |f| %>
  <%= render "shared/error_messages", object: @role %>
  <div class="row">
    <div class="col-md-1 title"><%= @role.name.capitalize %></div>
    <div class="col-md-1 col-md-offset-8"><%= f.submit t("buttons.save"),
      class: "btn btn-primary"%></div>
  </div>

  <table class="table table-striped">
    <tr>
      <th></th>
      <% Settings.all_functions.each do |function| %>
        <th><%= function.capitalize %></th>
      <% end %>
      <th>
        <%= check_box_tag "select-permission-all", "select-all", false %>
        <label for="select-permission-all"><%= t "roles.select_all" %></label>
      </th>
    </tr>
    <% @routes.each do |route| %>
      <tr>
        <td><%= route[:controller] %></td>

        <% Settings.all_functions.each do |function| %>
          <% if route[:actions].include? function %>
            <%= f.fields_for :functions, @role.functions.build do |builder| %>
              <%= builder.hidden_field :id,
                value: @role.decorate.function(function, route[:controller]) %>
              <%= builder.hidden_field :model_class, value: route[:controller] %>
              <%= builder.hidden_field :action, value: function %>
              <td>
                <%= builder.check_box :_destroy,
                  {checked: @role.decorate.function(function,
                  route[:controller]).present?}, false, true %>
              </td>
            <% end %>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  </table>
<% end %>
